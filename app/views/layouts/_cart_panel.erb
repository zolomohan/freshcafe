<% cart_items = get_cart_items %>
<div class="panel">
  <div class="header">
    <p class="lead">My Cart (<%=current_user.cart_count%>)</p>
    <i id="toggle-panel" class="fas fa-chevron-up"></i>
  </div>
  <div id="items" class="mt-3 d-none">
    <% if cart_items.count > 0 %>
      <% cart_items.each do |cart_item| %>
        <div class="item">
          <div class="left">
            <div class="name"><%= cart_item[:item].name%></div>
            <div class="quantity text-muted">Quantity: <%= cart_item[:quantity]%></div>
            <div id="item-actions" class="mt-2 ui circular labels">
              <%=link_to increase_quantity_cart_path(cart_item[:item]), method: :put, class: "me-2 ui label", style: "text-decoration: none" do %>
                <i class="fas fa-plus"></i>
              <% end %>
              <%=link_to decrease_quantity_cart_path(cart_item[:item]), method: :put, class: "me-2 ui label", style: "text-decoration: none" do %>
                <i class="fas fa-minus"></i>
              <% end %>
              <%=link_to remove_from_cart_path(cart_item[:item]), method: :put, class: "button ui negative label", style: "text-decoration: none" do %>
                <i class="fas fa-times"></i>
              <% end %>
            </div>
          </div>
          <div class="price text-muted">
            ₹ <%= cart_item[:item].price%>
          </div>
          
        </div>
        <hr>
      <% end %>
    <% else %>
        <p class="lead text-muted">Add Items to Purchase</p>
    <% end %>
  </div>
  <div id="panel-footer" class="footer d-none">
    <p class="lead mb-3 pt-3">Total Price: ₹ <%= cart_items.reduce(0)  {|sum, cart_item| sum + (cart_item[:item].price * cart_item[:quantity].to_i) } %></p>
    <% order_create_params = [] %>
    <% cart_items.each do |cart_item| %>
      <% order_create_params.push({:id => cart_item[:item].id, :name => cart_item[:item].name, :price => cart_item[:item].price, :quantity => cart_item[:quantity]}) %>
    <% end %>
    <%= button_to "Proceed to Checkout", order_path, params: {items: order_create_params.to_json}, class: "ui secondary button d-none", id: "checkout-button", style: "width: 100%"%>
  </div>
</div>
